# Kong Notes (API Gateway Rules)


## OPEN Endpoints (No Authentication Required)

These endpoints are accessible without JWT.
Kong authentication plugin must be DISABLED for these routes.

POST /signup/
POST /signup-final/
POST /verify-otp/
POST /resent-otp/
POST /login/
POST /login-2fa-verify-code/
POST /login-2fa-verify-backup/
POST /tokenrefresh/

### Notes
- Used by first-time or unauthenticated users
- Business validation is handled by Django
- Kong must not block these endpoints

---

## PROTECTED Endpoints (JWT Required)

These endpoints require a valid JWT.
Kong authentication plugin must be ENABLED.

POST /logout/
POST /settings_enable-2fa/
POST /user/{user_id}/change-role/
GET  /session-tests/

### Notes
- Requests without valid token must be blocked by Kong
- Backend should receive only authenticated traffic

---

## Authentication Contract

- Auth type: JWT
- Header:
  Authorization: Bearer <ACCESS_TOKEN>

### Token Requirements
- exp (expiration time)
- sub or user_id
- iss (issuer)

Token is generated by Django and validated by Kong.

---

## Responsibility Split

- Django:
  - Login / Signup logic
  - OTP & 2FA validation
  - Role & permission checks
  - Business rules

- Kong:
  - JWT validation
  - Blocking unauthorized requests
  - Preventing unnecessary backend & DB load

---

## Important Rules

- All non-auth endpoints MUST be protected by JWT
- Open endpoints must never require token
- Token structure must remain stable
